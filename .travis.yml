---
language: node_js
node_js:
  - "9"
cache: yarn
services:
  - mongodb
  - postgresql
env:
  - PGUSER=postgres PGDATABASE=machinomy_test NODE_ENV=test ENGINE_NAME=postgresql
  - PGUSER=postgres PGDATABASE=machinomy_test NODE_ENV=test ENGINE_NAME=sqlite
  - PGUSER=postgres PGDATABASE=machinomy_test NODE_ENV=test ENGINE_NAME=mongo
  - PGUSER=postgres PGDATABASE=machinomy_test NODE_ENV=test ENGINE_NAME=nedb
before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.7.0
  - export PATH="$HOME/.yarn/bin:$PATH"
  - yarn global add lerna
  - yarn global add codecov
  - lerna bootstrap
before_script:
  - psql -c 'create database machinomy_test;' -U postgres -d postgres
script:
  - yarn run lint
  - yarn run build
  - cd packages/machinomy && yarn migrate && cd ../../
  - yarn run test
  - yarn run coverage
after_script:
  - bash <(curl -s https://codecov.io/bash) -s packages -t $CODECOV
